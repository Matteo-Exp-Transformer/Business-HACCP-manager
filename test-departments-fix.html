<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Fix Reparti - HACCP Manager</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .success { color: #22c55e; }
        .error { color: #ef4444; }
        .warning { color: #f59e0b; }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #2563eb; }
        button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        .department-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            margin: 5px 0;
        }
        .department-item.enabled {
            background: #f0f9ff;
            border-color: #0ea5e9;
        }
        .department-item.disabled {
            background: #fef2f2;
            border-color: #f87171;
        }
    </style>
</head>
<body>
    <h1>üß™ Test Fix Reparti - HACCP Manager</h1>
    
    <div class="test-section">
        <h2>üîß Test Funzionalit√† Reparti</h2>
        <p>Questo test verifica che il fix dei reparti funzioni correttamente.</p>
        
        <div id="departments-container">
            <h3>Reparti Attuali:</h3>
            <div id="departments-list"></div>
        </div>
        
        <div id="validation-status">
            <h3>Stato Validazione:</h3>
            <p id="validation-message"></p>
        </div>
        
        <div id="actions">
            <button onclick="testToggleDepartment('cucina')">Toggle Cucina</button>
            <button onclick="testToggleDepartment('bancone')">Toggle Bancone</button>
            <button onclick="testToggleDepartment('sala')">Toggle Sala</button>
            <button onclick="testToggleDepartment('magazzino')">Toggle Magazzino</button>
            <button onclick="addCustomDepartment()">Aggiungi Reparto Custom</button>
            <button onclick="testConfirmStep()" id="confirm-btn">Conferma Step</button>
        </div>
        
        <div id="test-results">
            <h3>Risultati Test:</h3>
            <div id="results-list"></div>
        </div>
    </div>

    <script>
        // Simula lo stato dei reparti
        let departments = [
            { id: 'cucina', name: 'Cucina', enabled: true, isCustom: false, required: true },
            { id: 'bancone', name: 'Bancone', enabled: true, isCustom: false, required: true },
            { id: 'sala', name: 'Sala', enabled: true, isCustom: false, required: true },
            { id: 'magazzino', name: 'Magazzino', enabled: true, isCustom: false, required: true }
        ];

        let customDepartmentCounter = 1;

        function renderDepartments() {
            const container = document.getElementById('departments-list');
            container.innerHTML = '';
            
            departments.forEach(dept => {
                const div = document.createElement('div');
                div.className = `department-item ${dept.enabled ? 'enabled' : 'disabled'}`;
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.checked = dept.enabled;
                checkbox.disabled = dept.required;
                checkbox.onchange = () => toggleDepartment(dept.id);
                
                const label = document.createElement('span');
                label.textContent = `${dept.name} ${dept.required ? '(Richiesto)' : ''}`;
                
                const status = document.createElement('span');
                status.textContent = dept.enabled ? '‚úÖ Attivo' : '‚ùå Inattivo';
                status.className = dept.enabled ? 'success' : 'error';
                
                div.appendChild(checkbox);
                div.appendChild(label);
                div.appendChild(status);
                
                if (dept.isCustom) {
                    const removeBtn = document.createElement('button');
                    removeBtn.textContent = 'üóëÔ∏è';
                    removeBtn.onclick = () => removeCustomDepartment(dept.id);
                    removeBtn.style.background = '#ef4444';
                    removeBtn.style.fontSize = '12px';
                    removeBtn.style.padding = '5px 10px';
                    div.appendChild(removeBtn);
                }
                
                container.appendChild(div);
            });
            
            updateValidationStatus();
        }

        function toggleDepartment(id) {
            departments = departments.map(dept => {
                if (dept.id === id) {
                    if (dept.required && !dept.enabled) {
                        return dept; // Non permettere di disabilitare i reparti richiesti
                    }
                    return { ...dept, enabled: !dept.enabled };
                }
                return dept;
            });
            
            renderDepartments();
            addTestResult('info', `Reparto ${id} ${departments.find(d => d.id === id).enabled ? 'abilitato' : 'disabilitato'}`);
        }

        function addCustomDepartment() {
            const name = `Reparto Custom ${customDepartmentCounter}`;
            const newDept = {
                id: `custom-${Date.now()}`,
                name: name,
                enabled: true,
                isCustom: true,
                required: false
            };
            
            departments.push(newDept);
            customDepartmentCounter++;
            renderDepartments();
            addTestResult('success', `Reparto custom "${name}" aggiunto`);
        }

        function removeCustomDepartment(id) {
            departments = departments.filter(d => d.id !== id);
            renderDepartments();
            addTestResult('warning', 'Reparto custom rimosso');
        }

        function updateValidationStatus() {
            const enabledCount = departments.filter(d => d.enabled).length;
            const canProceed = enabledCount === 4;
            
            const messageEl = document.getElementById('validation-message');
            const confirmBtn = document.getElementById('confirm-btn');
            
            if (canProceed) {
                messageEl.innerHTML = `<span class="success">‚úÖ Reparti attivi: ${enabledCount}/4 - Requisito soddisfatto! Puoi procedere.</span>`;
                confirmBtn.disabled = false;
            } else {
                messageEl.innerHTML = `<span class="warning">‚ö†Ô∏è Reparti attivi: ${enabledCount}/4 - Devi attivare esattamente 4 reparti per continuare.</span>`;
                confirmBtn.disabled = true;
            }
            
            if (enabledCount > 4) {
                messageEl.innerHTML += `<br><span class="error">‚ùå Hai troppi reparti attivi. Disabilita alcuni reparti per avere esattamente 4.</span>`;
            }
        }

        function testConfirmStep() {
            const enabledCount = departments.filter(d => d.enabled).length;
            
            if (enabledCount === 4) {
                addTestResult('success', '‚úÖ Step confermato con successo! Puoi procedere al prossimo step.');
                
                // Simula la navigazione al prossimo step
                setTimeout(() => {
                    addTestResult('info', 'üîÑ Navigando al prossimo step...');
                }, 1000);
            } else {
                addTestResult('error', `‚ùå Impossibile confermare: ${enabledCount}/4 reparti attivi`);
            }
        }

        function addTestResult(type, message) {
            const resultsContainer = document.getElementById('results-list');
            const resultDiv = document.createElement('div');
            resultDiv.className = type;
            resultDiv.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            resultsContainer.appendChild(resultDiv);
            
            // Mantieni solo gli ultimi 10 risultati
            while (resultsContainer.children.length > 10) {
                resultsContainer.removeChild(resultsContainer.firstChild);
            }
        }

        function testToggleDepartment(id) {
            addTestResult('info', `Test toggle reparto: ${id}`);
            toggleDepartment(id);
        }

        // Inizializza la visualizzazione
        renderDepartments();
        addTestResult('info', 'üöÄ Test inizializzato. I reparti predefiniti sono sempre attivi e richiesti.');
    </script>
</body>
</html>
