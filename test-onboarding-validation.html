<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Validazione Onboarding HACCP</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .test-button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background-color: #0056b3;
        }
        .code-block {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>🧪 Test Validazione Onboarding HACCP</h1>
    <p>Questo file testa tutte le validazioni implementate nell'onboarding per verificare che funzionino correttamente.</p>

    <div class="test-section">
        <h2>✅ Test 1: Validazione Business Info</h2>
        <p>Testa la validazione dei dati aziendali:</p>
        <ul>
            <li>Nome attività (min 3 caratteri)</li>
            <li>Indirizzo (min 10 caratteri)</li>
            <li>Email (formato valido)</li>
            <li>Metodo di contatto obbligatorio</li>
        </ul>
        <button class="test-button" onclick="testBusinessValidation()">Testa Validazione Business</button>
        <div id="business-test-results"></div>
    </div>

    <div class="test-section">
        <h2>✅ Test 2: Validazione Reparti</h2>
        <p>Testa la validazione dei reparti:</p>
        <ul>
            <li>Almeno 4 reparti attivi</li>
            <li>Nomi unici e validi (min 2 caratteri)</li>
            <li>Distribuzione in almeno 2 posizioni</li>
            <li>Almeno una descrizione</li>
        </ul>
        <button class="test-button" onclick="testDepartmentsValidation()">Testa Validazione Reparti</button>
        <div id="departments-test-results"></div>
    </div>

    <div class="test-section">
        <h2>✅ Test 3: Validazione Staff</h2>
        <p>Testa la validazione dello staff:</p>
        <ul>
            <li>Almeno un membro</li>
            <li>Nomi unici e validi (min 3 caratteri)</li>
            <li>Ruoli e categorie validi</li>
            <li>Almeno un amministratore</li>
            <li>Distribuzione equilibrata dei ruoli</li>
            <li>Responsabilità specifiche</li>
        </ul>
        <button class="test-button" onclick="testStaffValidation()">Testa Validazione Staff</button>
        <div id="staff-test-results"></div>
    </div>

    <div class="test-section">
        <h2>✅ Test 4: Validazione Punti di Conservazione</h2>
        <p>Testa la validazione dei punti di conservazione:</p>
        <ul>
            <li>Almeno un punto</li>
            <li>Nomi unici e validi (min 2 caratteri)</li>
            <li>Posizioni valide (reparti attivi)</li>
            <li>Temperature valide (min < max)</li>
            <li>Ruoli assegnati validi</li>
            <li>Categorie prodotti obbligatorie</li>
            <li>Distribuzione in almeno 2 reparti</li>
            <li>Note o descrizioni</li>
        </ul>
        <button class="test-button" onclick="testConservationValidation()">Testa Validazione Conservazione</button>
        <div id="conservation-test-results"></div>
    </div>

    <div class="test-section">
        <h2>✅ Test 5: Validazione Attività e Mansioni</h2>
        <p>Testa la validazione delle attività:</p>
        <ul>
            <li>Almeno un'attività</li>
            <li>Nomi unici e validi (min 5 caratteri)</li>
            <li>Assegnazioni valide (staff esistente)</li>
            <li>Frequenze valide</li>
            <li>Attività monitoraggio temperature (una per punto conservazione)</li>
            <li>Frequenze diverse</li>
            <li>Priorità o note</li>
        </ul>
        <button class="test-button" onclick="testTasksValidation()">Testa Validazione Attività</button>
        <div id="tasks-test-results"></div>
    </div>

    <div class="test-section">
        <h2>✅ Test 6: Validazione Inventario</h2>
        <p>Testa la validazione dell'inventario:</p>
        <ul>
            <li>Almeno un prodotto</li>
            <li>Nomi unici e validi (min 2 caratteri)</li>
            <li>Tipologie valide</li>
            <li>Date scadenza nel futuro</li>
            <li>Posizioni valide (punti conservazione esistenti)</li>
            <li>Tipi diversi</li>
            <li>Note o descrizioni</li>
        </ul>
        <button class="test-button" onclick="testInventoryValidation()">Testa Validazione Inventario</button>
        <div id="inventory-test-results"></div>
    </div>

    <div class="test-section">
        <h2>🚀 Test Completo Onboarding</h2>
        <p>Testa tutte le validazioni insieme per verificare la coerenza globale:</p>
        <button class="test-button" onclick="testCompleteOnboarding()">Testa Onboarding Completo</button>
        <div id="complete-test-results"></div>
    </div>

    <script>
        // Simula le funzioni di validazione dell'onboarding
        const validateStep = (stepNumber, data) => {
            const errors = {};
            
            if (stepNumber === 0) { // Business Info
                if (!data.business?.name?.trim()) {
                    errors.businessName = "Il nome attività è obbligatorio";
                } else if (data.business.name.trim().length < 3) {
                    errors.businessName = "Il nome attività deve essere di almeno 3 caratteri";
                }
                if (!data.business?.address?.trim()) {
                    errors.address = "L'indirizzo è obbligatorio";
                } else if (data.business.address.trim().length < 10) {
                    errors.address = "L'indirizzo deve essere di almeno 10 caratteri";
                }
                if (!data.business?.email?.trim()) {
                    errors.email = "L'email è obbligatoria";
                } else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(data.business.email)) {
                    errors.email = "Inserisci una email valida (formato: nome@dominio.com)";
                }
                
                // Controlla che i dati di contatto siano completi
                if (!data.business?.phone?.trim() && !data.business?.email?.trim()) {
                    errors.contactInfo = "Devi fornire almeno un metodo di contatto (telefono o email)";
                }
            }
            
            if (stepNumber === 1) { // Reparti
                const departmentsList = data.departments?.list || [];
                const enabledDepartments = departmentsList.filter(dept => dept.enabled);
                if (enabledDepartments.length < 4) {
                    errors.departments = "Devi attivare almeno 4 reparti per procedere";
                } else {
                    // Controlla che i reparti attivi abbiano nomi validi
                    enabledDepartments.forEach((dept, index) => {
                        if (!dept.name?.trim() || dept.name.trim().length < 2) {
                            errors[`department_${index}_name`] = "Nome reparto deve essere di almeno 2 caratteri";
                        }
                    });
                    
                    // Controlla che i nomi dei reparti siano unici
                    const names = enabledDepartments.map(dept => dept.name.toLowerCase().trim());
                    const uniqueNames = new Set(names);
                    if (names.length !== uniqueNames.size) {
                        errors.departmentNames = "I nomi dei reparti devono essere unici";
                    }
                    
                    // Controlla che i reparti abbiano posizioni diverse
                    const locations = enabledDepartments.map(dept => dept.location || 'generale');
                    const uniqueLocations = new Set(locations);
                    if (uniqueLocations.size < 2) {
                        errors.departmentLocations = "I reparti devono essere distribuiti in almeno 2 posizioni diverse";
                    }
                    
                    // Controlla che i reparti abbiano descrizioni
                    const hasDescriptions = enabledDepartments.some(dept => dept.description || dept.notes);
                    if (!hasDescriptions) {
                        errors.departmentDescriptions = "Almeno un reparto deve avere una descrizione o note";
                    }
                }
            }
            
            if (stepNumber === 2) { // Staff
                const staffMembers = data.staff?.staffMembers || [];
                if (staffMembers.length === 0) {
                    errors.staff = "Devi aggiungere almeno un membro dello staff";
                } else {
                    // Controlla ogni membro individualmente
                    staffMembers.forEach((member, index) => {
                        if (!member.fullName?.trim()) {
                            errors[`staff_${index}_name`] = "Nome obbligatorio";
                        } else if (member.fullName.trim().length < 3) {
                            errors[`staff_${index}_name`] = "Nome deve essere di almeno 3 caratteri";
                        }
                        if (!member.role) {
                            errors[`staff_${index}_role`] = "Ruolo obbligatorio";
                        } else {
                            const validRoles = ['Amministratore', 'Responsabile', 'Dipendente', 'Collaboratore Occasionale / Part-time'];
                            if (!validRoles.includes(member.role)) {
                                errors[`staff_${index}_role`] = "Ruolo non valido - seleziona un ruolo valido";
                            }
                        }
                        if (!member.category) {
                            errors[`staff_${index}_category`] = "Categoria obbligatoria";
                        } else {
                            const validCategories = ['Cuochi', 'Banconisti', 'Camerieri', 'Social & Media Manager', 'Amministratore'];
                            if (!validCategories.includes(member.category)) {
                                errors[`staff_${index}_category`] = "Categoria non valida - seleziona una categoria valida";
                            }
                        }
                        
                        // Controlla che il ruolo e la categoria siano compatibili
                        if (member.role === 'Amministratore' && member.category !== 'Amministratore') {
                            errors[`staff_${index}_category`] = "Il ruolo 'Amministratore' deve essere associato alla categoria 'Amministratore'";
                        }
                        
                        // Controlla che le date HACCP siano valide
                        if (member.category !== 'Social & Media Manager' && member.haccpExpiry) {
                            const expiryDate = new Date(member.haccpExpiry);
                            const today = new Date();
                            today.setHours(0, 0, 0, 0);
                            if (expiryDate < today) {
                                errors[`staff_${index}_haccp`] = "La data di scadenza HACCP deve essere nel futuro";
                            }
                        }
                    });
                    
                    // Controlla che i nomi dei membri siano unici
                    const names = staffMembers.map(member => member.fullName.toLowerCase().trim());
                    const uniqueNames = new Set(names);
                    if (names.length !== uniqueNames.size) {
                        errors.staffNames = "I nomi dei membri dello staff devono essere unici";
                    }
                    
                    // Controlla che ci sia almeno un amministratore
                    const hasAdmin = staffMembers.some(member => member.role === 'Amministratore');
                    if (!hasAdmin) {
                        errors.adminRequired = "Devi avere almeno un membro con ruolo 'Amministratore'";
                    }
                    
                    // Controlla che ci sia una distribuzione equilibrata dei ruoli
                    const roles = staffMembers.map(member => member.role);
                    const uniqueRoles = new Set(roles);
                    if (uniqueRoles.size < 2) {
                        errors.roleDistribution = "Devi avere almeno 2 ruoli diversi per una gestione efficace";
                    }
                    
                    // Controlla che i membri abbiano responsabilità specifiche
                    const hasResponsibilities = staffMembers.some(member => member.responsibilities || member.notes);
                    if (!hasResponsibilities) {
                        errors.staffResponsibilities = "Almeno un membro deve avere responsabilità specifiche o note";
                    }
                }
            }
            
            if (stepNumber === 3) { // Punti di Conservazione
                const conservationPoints = data.conservation?.points || [];
                if (conservationPoints.length === 0) {
                    errors.conservation = "Devi aggiungere almeno un punto di conservazione";
                } else {
                    conservationPoints.forEach((point, index) => {
                        if (!point.name?.trim()) {
                            errors[`conservation_${index}_name`] = "Nome obbligatorio";
                        } else if (point.name.trim().length < 2) {
                            errors[`conservation_${index}_name`] = "Nome deve essere di almeno 2 caratteri";
                        }
                        if (!point.location) {
                            errors[`conservation_${index}_location`] = "Posizione obbligatoria";
                        } else {
                            // Controlla che la posizione sia un reparto valido
                            const departments = data.departments?.list || [];
                            const validLocation = departments.find(dept => dept.name === point.location && dept.enabled);
                            if (!validLocation) {
                                errors[`conservation_${index}_location`] = "Posizione non valida - seleziona un reparto attivo";
                            }
                        }
                        if (!point.minTemp || !point.maxTemp) {
                            errors[`conservation_${index}_temperature`] = "Range temperature obbligatorio";
                        } else {
                            const min = parseFloat(point.minTemp);
                            const max = parseFloat(point.maxTemp);
                            if (isNaN(min) || isNaN(max)) {
                                errors[`conservation_${index}_temperature`] = "Temperature non valide";
                            } else if (min >= max) {
                                errors[`conservation_${index}_temperature`] = "Temperatura minima deve essere inferiore alla massima";
                            }
                        }
                        if (!point.assignedRole) {
                            errors[`conservation_${index}_assigned`] = "Assegnazione obbligatoria";
                        } else {
                            const validRoles = ['Cuochi', 'Banconisti', 'Camerieri', 'Responsabile', 'Dipendente'];
                            if (!validRoles.includes(point.assignedRole)) {
                                errors[`conservation_${index}_assigned`] = "Ruolo non valido - seleziona una categoria valida";
                            }
                        }
                        if (!point.selectedCategories || point.selectedCategories.length === 0) {
                            errors[`conservation_${index}_categories`] = "Categorie prodotti obbligatorie";
                        } else {
                            const validCategories = ['fresh_dairy', 'fresh_meat', 'fresh_fish', 'fresh_produce', 'fresh_fruits', 'frozen', 'deep_frozen', 'dry_goods', 'hot_holding', 'chilled_ready'];
                            point.selectedCategories.forEach(categoryId => {
                                if (!validCategories.includes(categoryId)) {
                                    errors[`conservation_${index}_categories`] = "Categoria non valida - seleziona categorie valide";
                                }
                            });
                        }
                    });
                    
                    // Controlla che i nomi dei punti di conservazione siano unici
                    const names = conservationPoints.map(point => point.name.toLowerCase().trim());
                    const uniqueNames = new Set(names);
                    if (names.length !== uniqueNames.size) {
                        errors.conservationNames = "I nomi dei punti di conservazione devono essere unici";
                    }
                    
                    // Controlla che i punti abbiano posizioni diverse
                    const locations = conservationPoints.map(point => point.location);
                    const uniqueLocations = new Set(locations);
                    if (uniqueLocations.size < 2) {
                        errors.conservationLocations = "I punti di conservazione devono essere distribuiti in almeno 2 reparti diversi";
                    }
                    
                    // Controlla che i punti abbiano note o descrizioni
                    const hasNotes = conservationPoints.some(point => point.notes || point.description);
                    if (!hasNotes) {
                        errors.conservationNotes = "Almeno un punto di conservazione deve avere note o descrizioni";
                    }
                }
            }
            
            if (stepNumber === 4) { // Mansioni e Attività
                const tasksList = data.tasks?.list || [];
                if (tasksList.length === 0) {
                    errors.tasks = "Devi aggiungere almeno un'attività";
                } else {
                    tasksList.forEach((task, index) => {
                        if (!task.name?.trim()) {
                            errors[`task_${index}_name`] = "Nome attività obbligatorio";
                        } else if (task.name.trim().length < 5) {
                            errors[`task_${index}_name`] = "Nome attività deve essere di almeno 5 caratteri";
                        }
                        if (!task.assignedTo) {
                            errors[`task_${index}_assigned`] = "Assegnazione obbligatoria";
                        }
                        if (!task.frequency) {
                            errors[`task_${index}_frequency`] = "Frequenza obbligatoria";
                        } else {
                            const validFrequencies = ['Giornalmente', 'Settimanalmente', 'Mensilmente', 'Annualmente'];
                            if (!validFrequencies.includes(task.frequency)) {
                                errors[`task_${index}_frequency`] = "Frequenza non valida - seleziona una frequenza valida";
                            }
                        }
                    });
                    
                    // Controlla che ci siano abbastanza attività di monitoraggio temperature
                    const conservationPoints = data.conservation?.points || [];
                    const temperatureTasks = tasksList.filter(task => 
                        task.name.toLowerCase().includes('rilevamento temperature')
                    );
                    
                    if (temperatureTasks.length < conservationPoints.length) {
                        errors.temperatureTasks = `Devi creare almeno ${conservationPoints.length} attività di monitoraggio temperature (una per ogni punto di conservazione)`;
                    }
                    
                    // Controlla che le attività siano assegnate a membri dello staff validi
                    const staffMembers = data.staff?.staffMembers || [];
                    if (staffMembers.length === 0) {
                        errors.staffRequired = "Devi prima configurare lo staff per assegnare le attività";
                    } else {
                        // Controlla che ogni attività sia assegnata a un membro dello staff valido
                        tasksList.forEach((task, index) => {
                            const assignedMember = staffMembers.find(member => member.fullName === task.assignedTo);
                            if (!assignedMember) {
                                errors[`task_${index}_assigned`] = "Assegnazione non valida - seleziona un membro dello staff esistente";
                            }
                        });
                    }
                    
                    // Controlla che i nomi delle attività siano unici
                    const names = tasksList.map(task => task.name.toLowerCase().trim());
                    const uniqueNames = new Set(names);
                    if (names.length !== uniqueNames.size) {
                        errors.taskNames = "I nomi delle attività devono essere unici";
                    }
                    
                    // Controlla che le attività abbiano frequenze diverse
                    const frequencies = tasksList.map(task => task.frequency);
                    const uniqueFrequencies = new Set(frequencies);
                    if (uniqueFrequencies.size < 2) {
                        errors.taskFrequencies = "Le attività devono avere frequenze diverse per una gestione efficace";
                    }
                    
                    // Controlla che le attività abbiano priorità o note
                    const hasPriorities = tasksList.some(task => task.priority || task.notes);
                    if (!hasPriorities) {
                        errors.taskPriorities = "Almeno un'attività deve avere una priorità o note";
                    }
                }
            }
            
            if (stepNumber === 5) { // Inventario Prodotti
                const productsList = data.inventory?.products || [];
                if (productsList.length === 0) {
                    errors.inventory = "Devi aggiungere almeno un prodotto";
                } else {
                    productsList.forEach((product, index) => {
                        if (!product.name?.trim()) {
                            errors[`product_${index}_name`] = "Nome prodotto obbligatorio";
                        } else if (product.name.trim().length < 2) {
                            errors[`product_${index}_name`] = "Nome prodotto deve essere di almeno 2 caratteri";
                        }
                        if (!product.type) {
                            errors[`product_${index}_type`] = "Tipologia obbligatoria";
                        } else {
                            const validTypes = ['Latticini e Formaggi', 'Carni Fresche', 'Pesce e Frutti di Mare', 'Verdure e Ortaggi', 'Frutta', 'Prodotti da Forno', 'Bevande', 'Altro'];
                            if (!validTypes.includes(product.type)) {
                                errors[`product_${index}_type`] = "Tipologia non valida - seleziona una tipologia valida";
                            }
                        }
                        if (!product.expiryDate) {
                            errors[`product_${index}_expiry`] = "Data scadenza obbligatoria";
                        } else {
                            const expiryDate = new Date(product.expiryDate);
                            const today = new Date();
                            today.setHours(0, 0, 0, 0);
                            if (expiryDate < today) {
                                errors[`product_${index}_expiry`] = "La data di scadenza deve essere nel futuro";
                            }
                        }
                        if (!product.position) {
                            errors[`product_${index}_position`] = "Posizione obbligatoria";
                        }
                    });
                    
                    // Controlla che i prodotti siano assegnati a punti di conservazione validi
                    const conservationPoints = data.conservation?.points || [];
                    if (conservationPoints.length === 0) {
                        errors.conservationRequired = "Devi prima configurare i punti di conservazione per assegnare i prodotti";
                    } else {
                        // Controlla che ogni prodotto sia assegnato a un punto di conservazione valido
                        productsList.forEach((product, index) => {
                            const position = conservationPoints.find(point => point.id === parseInt(product.position));
                            if (!position) {
                                errors[`product_${index}_position`] = "Posizione non valida - seleziona un punto di conservazione esistente";
                            }
                        });
                    }
                    
                    // Controlla che i nomi dei prodotti siano unici
                    const names = productsList.map(product => product.name.toLowerCase().trim());
                    const uniqueNames = new Set(names);
                    if (names.length !== uniqueNames.size) {
                        errors.productNames = "I nomi dei prodotti devono essere unici";
                    }
                    
                    // Controlla che i prodotti abbiano tipi diversi
                    const types = productsList.map(product => product.type);
                    const uniqueTypes = new Set(types);
                    if (types.length !== uniqueTypes.size) {
                        errors.productTypes = "I prodotti devono avere tipi diversi per una gestione efficace";
                    }
                    
                    // Controlla che i prodotti abbiano note o descrizioni
                    const hasNotes = productsList.some(product => product.notes || product.description);
                    if (!hasNotes) {
                        errors.productNotes = "Almeno un prodotto deve avere note o descrizioni";
                    }
                }
            }
            
            return errors;
        };

        // Funzioni di test
        function testBusinessValidation() {
            const testData = {
                business: {
                    name: 'Test',
                    address: 'Via Test 123, Città',
                    email: 'test@example.com',
                    phone: '+39 123 456 789'
                }
            };
            
            const errors = validateStep(0, testData);
            const resultsDiv = document.getElementById('business-test-results');
            
            if (Object.keys(errors).length === 0) {
                resultsDiv.innerHTML = '<div class="test-result success">✅ Validazione Business Info: PASSATA</div>';
            } else {
                resultsDiv.innerHTML = '<div class="test-result error">❌ Validazione Business Info: FALLITA</div>' +
                    '<div class="code-block">Errori: ' + JSON.stringify(errors, null, 2) + '</div>';
            }
        }

        function testDepartmentsValidation() {
            const testData = {
                departments: {
                    list: [
                        { name: 'Cucina', enabled: true, location: 'Piano Terra', description: 'Reparto cucina' },
                        { name: 'Bancone', enabled: true, location: 'Piano Terra', description: 'Reparto bancone' },
                        { name: 'Sala', enabled: true, location: 'Piano Superiore', description: 'Reparto sala' },
                        { name: 'Magazzino', enabled: true, location: 'Seminterrato', description: 'Reparto magazzino' }
                    ]
                }
            };
            
            const errors = validateStep(1, testData);
            const resultsDiv = document.getElementById('departments-test-results');
            
            if (Object.keys(errors).length === 0) {
                resultsDiv.innerHTML = '<div class="test-result success">✅ Validazione Reparti: PASSATA</div>';
            } else {
                resultsDiv.innerHTML = '<div class="test-result error">❌ Validazione Reparti: FALLITA</div>' +
                    '<div class="code-block">Errori: ' + JSON.stringify(errors, null, 2) + '</div>';
            }
        }

        function testStaffValidation() {
            const testData = {
                staff: {
                    staffMembers: [
                        { 
                            fullName: 'Mario Rossi', 
                            role: 'Amministratore', 
                            category: 'Amministratore',
                            responsibilities: 'Gestione generale',
                            haccpExpiry: '2025-12-31'
                        },
                        { 
                            fullName: 'Giulia Bianchi', 
                            role: 'Responsabile', 
                            category: 'Cuochi',
                            responsibilities: 'Gestione cucina'
                        }
                    ]
                }
            };
            
            const errors = validateStep(2, testData);
            const resultsDiv = document.getElementById('staff-test-results');
            
            if (Object.keys(errors).length === 0) {
                resultsDiv.innerHTML = '<div class="test-result success">✅ Validazione Staff: PASSATA</div>';
            } else {
                resultsDiv.innerHTML = '<div class="test-result error">❌ Validazione Staff: FALLITA</div>' +
                    '<div class="code-block">Errori: ' + JSON.stringify(errors, null, 2) + '</div>';
            }
        }

        function testConservationValidation() {
            const testData = {
                departments: {
                    list: [
                        { name: 'Cucina', enabled: true },
                        { name: 'Bancone', enabled: true }
                    ]
                },
                conservation: {
                    points: [
                        {
                            name: 'Frigo A',
                            location: 'Cucina',
                            minTemp: 2,
                            maxTemp: 4,
                            assignedRole: 'Cuochi',
                            selectedCategories: ['fresh_dairy', 'fresh_meat'],
                            notes: 'Frigorifero principale cucina'
                        },
                        {
                            name: 'Freezer',
                            location: 'Bancone',
                            minTemp: -20,
                            maxTemp: -18,
                            assignedRole: 'Banconisti',
                            selectedCategories: ['frozen'],
                            notes: 'Freezer bancone'
                        }
                    ]
                }
            };
            
            const errors = validateStep(3, testData);
            const resultsDiv = document.getElementById('conservation-test-results');
            
            if (Object.keys(errors).length === 0) {
                resultsDiv.innerHTML = '<div class="test-result success">✅ Validazione Punti di Conservazione: PASSATA</div>';
            } else {
                resultsDiv.innerHTML = '<div class="test-result error">❌ Validazione Punti di Conservazione: FALLITA</div>' +
                    '<div class="code-block">Errori: ' + JSON.stringify(errors, null, 2) + '</div>';
            }
        }

        function testTasksValidation() {
            const testData = {
                staff: {
                    staffMembers: [
                        { fullName: 'Mario Rossi', role: 'Amministratore', category: 'Amministratore' },
                        { fullName: 'Giulia Bianchi', role: 'Responsabile', category: 'Cuochi' }
                    ]
                },
                conservation: {
                    points: [
                        { id: 1, name: 'Frigo A' },
                        { id: 2, name: 'Freezer' }
                    ]
                },
                tasks: {
                    list: [
                        {
                            name: 'Rilevamento temperature Frigo A',
                            assignedTo: 'Mario Rossi',
                            frequency: 'Giornalmente',
                            priority: 'Alta'
                        },
                        {
                            name: 'Rilevamento temperature Freezer',
                            assignedTo: 'Giulia Bianchi',
                            frequency: 'Settimanalmente',
                            priority: 'Media'
                        }
                    ]
                }
            };
            
            const errors = validateStep(4, testData);
            const resultsDiv = document.getElementById('tasks-test-results');
            
            if (Object.keys(errors).length === 0) {
                resultsDiv.innerHTML = '<div class="test-result success">✅ Validazione Attività: PASSATA</div>';
            } else {
                resultsDiv.innerHTML = '<div class="test-result error">❌ Validazione Attività: FALLITA</div>' +
                    '<div class="code-block">Errori: ' + JSON.stringify(errors, null, 2) + '</div>';
            }
        }

        function testInventoryValidation() {
            const testData = {
                conservation: {
                    points: [
                        { id: 1, name: 'Frigo A' },
                        { id: 2, name: 'Freezer' }
                    ]
                },
                inventory: {
                    products: [
                        {
                            name: 'Latte',
                            type: 'Latticini e Formaggi',
                            expiryDate: '2024-12-31',
                            position: '1',
                            notes: 'Latte fresco'
                        },
                        {
                            name: 'Gelato',
                            type: 'Surgelati',
                            expiryDate: '2025-06-30',
                            position: '2',
                            notes: 'Gelato artigianale'
                        }
                    ]
                }
            };
            
            const errors = validateStep(5, testData);
            const resultsDiv = document.getElementById('inventory-test-results');
            
            if (Object.keys(errors).length === 0) {
                resultsDiv.innerHTML = '<div class="test-result success">✅ Validazione Inventario: PASSATA</div>';
            } else {
                resultsDiv.innerHTML = '<div class="test-result error">❌ Validazione Inventario: FALLITA</div>' +
                    '<div class="code-block">Errori: ' + JSON.stringify(errors, null, 2) + '</div>';
            }
        }

        function testCompleteOnboarding() {
            const testData = {
                business: {
                    name: 'Ristorante Test',
                    address: 'Via Roma 123, Milano, Italia',
                    email: 'info@ristorante-test.it',
                    phone: '+39 02 1234567'
                },
                departments: {
                    list: [
                        { name: 'Cucina', enabled: true, location: 'Piano Terra', description: 'Reparto cucina principale' },
                        { name: 'Bancone', enabled: true, location: 'Piano Terra', description: 'Reparto bancone bar' },
                        { name: 'Sala', enabled: true, location: 'Piano Superiore', description: 'Reparto sala ristorante' },
                        { name: 'Magazzino', enabled: true, location: 'Seminterrato', description: 'Reparto magazzino generi' }
                    ]
                },
                staff: {
                    staffMembers: [
                        { 
                            fullName: 'Mario Rossi', 
                            role: 'Amministratore', 
                            category: 'Amministratore',
                            responsibilities: 'Gestione generale ristorante',
                            haccpExpiry: '2025-12-31'
                        },
                        { 
                            fullName: 'Giulia Bianchi', 
                            role: 'Responsabile', 
                            category: 'Cuochi',
                            responsibilities: 'Gestione cucina e menu'
                        },
                        { 
                            fullName: 'Luca Verdi', 
                            role: 'Dipendente', 
                            category: 'Banconisti',
                            responsibilities: 'Gestione bancone e bar'
                        }
                    ]
                },
                conservation: {
                    points: [
                        {
                            name: 'Frigo Cucina',
                            location: 'Cucina',
                            minTemp: 2,
                            maxTemp: 4,
                            assignedRole: 'Cuochi',
                            selectedCategories: ['fresh_dairy', 'fresh_meat'],
                            notes: 'Frigorifero principale cucina per latticini e carni'
                        },
                        {
                            name: 'Freezer Magazzino',
                            location: 'Magazzino',
                            minTemp: -20,
                            maxTemp: -18,
                            assignedRole: 'Responsabile',
                            selectedCategories: ['frozen'],
                            notes: 'Freezer magazzino per surgelati'
                        }
                    ]
                },
                tasks: {
                    list: [
                        {
                            name: 'Rilevamento temperature Frigo Cucina',
                            assignedTo: 'Giulia Bianchi',
                            frequency: 'Giornalmente',
                            priority: 'Alta',
                            notes: 'Controllo temperature mattina e sera'
                        },
                        {
                            name: 'Rilevamento temperature Freezer Magazzino',
                            assignedTo: 'Mario Rossi',
                            frequency: 'Settimanalmente',
                            priority: 'Media',
                            notes: 'Controllo temperature settimanale'
                        }
                    ]
                },
                inventory: {
                    products: [
                        {
                            name: 'Latte Fresco',
                            type: 'Latticini e Formaggi',
                            expiryDate: '2024-12-31',
                            position: '1',
                            notes: 'Latte fresco di produzione giornaliera'
                        },
                        {
                            name: 'Gelato Artigianale',
                            type: 'Surgelati',
                            expiryDate: '2025-06-30',
                            position: '2',
                            notes: 'Gelato artigianale produzione propria'
                        }
                    ]
                }
            };
            
            let allErrors = {};
            for (let i = 0; i < 6; i++) {
                const errors = validateStep(i, testData);
                allErrors[`Step ${i}`] = errors;
            }
            
            const resultsDiv = document.getElementById('complete-test-results');
            const totalErrors = Object.values(allErrors).reduce((sum, errors) => sum + Object.keys(errors).length, 0);
            
            if (totalErrors === 0) {
                resultsDiv.innerHTML = '<div class="test-result success">🎉 Onboarding Completo: TUTTI I TEST PASSATI!</div>' +
                    '<div class="code-block">Dati di test validi per tutti gli step</div>';
            } else {
                resultsDiv.innerHTML = '<div class="test-result error">❌ Onboarding Completo: ALCUNI TEST FALLITI</div>' +
                    '<div class="code-block">Errori totali: ' + totalErrors + '\n\n' + JSON.stringify(allErrors, null, 2) + '</div>';
            }
        }
    </script>
</body>
</html>
