<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Categoria Bevande Fresche</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background-color: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background-color: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .info { background-color: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
        .category { margin: 5px 0; padding: 5px; border: 1px solid #ddd; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>🧪 Test Categoria "Bevande Fresche" - Range 3-10°C</h1>
    
    <div id="test-results"></div>
    
    <script>
        // Simula le categorie HACCP con la nuova categoria bevande fresche
        const CONSERVATION_POINT_RULES = {
            categories: [
                {
                    id: 'fresh_dairy',
                    name: 'Latticini e Formaggi',
                    minTemp: 2,
                    maxTemp: 4,
                    description: 'Latte, formaggi freschi, yogurt',
                    incompatibleWith: ['frozen', 'dry_goods', 'hot_holding']
                },
                {
                    id: 'fresh_meat',
                    name: 'Carni Fresche',
                    minTemp: 0,
                    maxTemp: 4,
                    description: 'Carni crude, pollame, salumi freschi',
                    incompatibleWith: ['frozen', 'dry_goods', 'hot_holding']
                },
                {
                    id: 'fresh_fish',
                    name: 'Pesce Fresco',
                    minTemp: 0,
                    maxTemp: 2,
                    description: 'Pesce fresco, molluschi, crostacei',
                    incompatibleWith: ['frozen', 'dry_goods', 'hot_holding']
                },
                {
                    id: 'fresh_produce',
                    name: 'Verdure e Ortaggi',
                    minTemp: 2,
                    maxTemp: 8,
                    description: 'Verdure fresche, insalate, ortaggi',
                    incompatibleWith: ['frozen', 'hot_holding']
                },
                {
                    id: 'fresh_fruits',
                    name: 'Frutta Fresca',
                    minTemp: 2,
                    maxTemp: 8,
                    description: 'Frutta fresca di stagione',
                    incompatibleWith: ['frozen', 'hot_holding']
                },
                {
                    id: 'frozen',
                    name: 'Surgelati',
                    minTemp: -20,
                    maxTemp: -16,
                    description: 'Tutti i prodotti surgelati',
                    incompatibleWith: ['fresh_dairy', 'fresh_meat', 'fresh_fish', 'fresh_produce', 'fresh_fruits', 'hot_holding', 'fresh_beverages']
                },
                {
                    id: 'deep_frozen',
                    name: 'Ultra Surgelati',
                    minTemp: -25,
                    maxTemp: -18,
                    description: 'Prodotti ultra surgelati (es. gelati)',
                    incompatibleWith: ['fresh_dairy', 'fresh_meat', 'fresh_fish', 'fresh_produce', 'fresh_fruits', 'hot_holding', 'fresh_beverages']
                },
                {
                    id: 'dry_goods',
                    name: 'Dispensa Secca',
                    minTemp: 15,
                    maxTemp: 25,
                    description: 'Pasta, riso, farina, conserve',
                    incompatibleWith: ['fresh_dairy', 'fresh_meat', 'fresh_fish', 'frozen', 'deep_frozen']
                },
                {
                    id: 'hot_holding',
                    name: 'Mantenimento Caldo',
                    minTemp: 60,
                    maxTemp: 70,
                    description: 'Piatti pronti caldi, mantenuti a temperatura',
                    incompatibleWith: ['fresh_dairy', 'fresh_meat', 'fresh_fish', 'fresh_produce', 'fresh_fruits', 'frozen', 'deep_frozen', 'fresh_beverages']
                },
                {
                    id: 'chilled_ready',
                    name: 'Pronti Freddi',
                    minTemp: 2,
                    maxTemp: 8,
                    description: 'Piatti pronti freddi, insalate pronte',
                    incompatibleWith: ['frozen', 'deep_frozen', 'hot_holding']
                },
                {
                    id: 'fresh_beverages',
                    name: 'Bevande Fresche',
                    minTemp: 3,
                    maxTemp: 10,
                    description: 'Bibite, succhi, acqua, bevande fresche',
                    incompatibleWith: ['frozen', 'deep_frozen', 'hot_holding']
                }
            ],
            tolerance: 0.5
        };

        // Funzione per testare la validazione HACCP
        function testHACCPValidation(temperature, selectedCategories) {
            const temp = parseFloat(temperature);
            if (isNaN(temp)) return { compliant: false, message: 'Temperatura non valida' };
            
            const tolerance = CONSERVATION_POINT_RULES.tolerance;
            let allInRange = true;
            let allInToleranceRange = true;
            let incompatibleCategories = [];
            
            for (const categoryId of selectedCategories) {
                const category = CONSERVATION_POINT_RULES.categories.find(c => c.id === categoryId);
                if (category) {
                    const inRange = temp >= category.minTemp && temp <= category.maxTemp;
                    const categoryMin = category.minTemp - tolerance;
                    const categoryMax = category.maxTemp + tolerance;
                    const inToleranceRange = temp >= categoryMin && temp <= categoryMax;
                    
                    if (!inRange) {
                        allInRange = false;
                        if (!inToleranceRange) {
                            allInToleranceRange = false;
                            incompatibleCategories.push(category.name);
                        }
                    }
                }
            }
            
            if (allInRange) {
                return { compliant: true, message: '✅ Conforme HACCP', type: 'compliant' };
            } else if (allInToleranceRange) {
                return { compliant: true, message: '⚠️ In tolleranza HACCP', type: 'warning' };
            } else {
                return { 
                    compliant: false, 
                    message: `❌ Non conforme HACCP - Categorie incompatibili: ${incompatibleCategories.join(', ')}`, 
                    type: 'error' 
                };
            }
        }

        // Test cases per la categoria bevande fresche
        const testCases = [
            {
                name: "Bevande Fresche - Temperatura Ottimale (6°C)",
                temperature: 6,
                categories: ['fresh_beverages'],
                expected: 'compliant'
            },
            {
                name: "Bevande Fresche - Range Minimo (3°C)",
                temperature: 3,
                categories: ['fresh_beverages'],
                expected: 'compliant'
            },
            {
                name: "Bevande Fresche - Range Massimo (10°C)",
                temperature: 10,
                categories: ['fresh_beverages'],
                expected: 'compliant'
            },
            {
                name: "Bevande Fresche - Tolleranza Minima (2.5°C)",
                temperature: 2.5,
                categories: ['fresh_beverages'],
                expected: 'warning'
            },
            {
                name: "Bevande Fresche - Tolleranza Massima (10.5°C)",
                temperature: 10.5,
                categories: ['fresh_beverages'],
                expected: 'warning'
            },
            {
                name: "Bevande Fresche - Troppo Freddo (1°C)",
                temperature: 1,
                categories: ['fresh_beverages'],
                expected: 'error'
            },
            {
                name: "Bevande Fresche - Troppo Caldo (15°C)",
                temperature: 15,
                categories: ['fresh_beverages'],
                expected: 'error'
            },
            {
                name: "Bevande Fresche + Pronti Freddi - Compatibili (5°C)",
                temperature: 5,
                categories: ['fresh_beverages', 'chilled_ready'],
                expected: 'compliant'
            },
            {
                name: "Bevande Fresche + Surgelati - Incompatibili (5°C)",
                temperature: 5,
                categories: ['fresh_beverages', 'frozen'],
                expected: 'error'
            }
        ];

        // Esegui test
        function runTests() {
            const resultsDiv = document.getElementById('test-results');
            let allPassed = true;
            
            resultsDiv.innerHTML = '<div class="info">🔄 Eseguendo test di validazione HACCP per categoria "Bevande Fresche"...</div>';
            
            // Mostra tutte le categorie disponibili
            const categoriesDiv = document.createElement('div');
            categoriesDiv.className = 'test-result info';
            categoriesDiv.innerHTML = '<h3>📋 Categorie Disponibili:</h3>';
            CONSERVATION_POINT_RULES.categories.forEach(category => {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'category';
                categoryDiv.innerHTML = `
                    <strong>${category.name}</strong> (${category.id})<br>
                    Range: ${category.minTemp}°C - ${category.maxTemp}°C<br>
                    Descrizione: ${category.description}
                `;
                categoriesDiv.appendChild(categoryDiv);
            });
            resultsDiv.appendChild(categoriesDiv);
            
            // Esegui test cases
            testCases.forEach((testCase, index) => {
                const result = testHACCPValidation(testCase.temperature, testCase.categories);
                const passed = result.type === testCase.expected;
                if (!passed) allPassed = false;
                
                const resultClass = passed ? 'success' : 'error';
                const statusIcon = passed ? '✅' : '❌';
                
                const testDiv = document.createElement('div');
                testDiv.className = `test-result ${resultClass}`;
                testDiv.innerHTML = `
                    <h4>${statusIcon} Test ${index + 1}: ${testCase.name}</h4>
                    <p><strong>Temperatura:</strong> ${testCase.temperature}°C</p>
                    <p><strong>Categorie:</strong> ${testCase.categories.join(', ')}</p>
                    <p><strong>Risultato:</strong> ${result.message}</p>
                    <p><strong>Atteso:</strong> ${testCase.expected}</p>
                    <p><strong>Stato:</strong> ${passed ? 'PASSED' : 'FAILED'}</p>
                `;
                resultsDiv.appendChild(testDiv);
            });
            
            // Risultato finale
            const finalDiv = document.createElement('div');
            finalDiv.className = `test-result ${allPassed ? 'success' : 'error'}`;
            finalDiv.innerHTML = `
                <h2>${allPassed ? '🎉 TUTTI I TEST SUPERATI!' : '⚠️ ALCUNI TEST FALLITI'}</h2>
                <p>${allPassed ? 
                    'La categoria "Bevande Fresche" funziona correttamente con range 3-10°C.' : 
                    'Ci sono problemi con la validazione della categoria "Bevande Fresche".'
                }</p>
            `;
            resultsDiv.appendChild(finalDiv);
        }

        // Esegui test al caricamento
        runTests();
    </script>
</body>
</html>
